<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-Level 7-Iron Analysis: Performance Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --golf-green: #0a7e36;
            --golf-tee: #1a936f;
            --golf-fairway: #2a9d8f;
            --golf-sand: #e9c46a;
            --golf-water: #2a9df4;
            --golf-danger: #e76f51;
        }
        
        body { 
            background: radial-gradient(circle at top, #0a1626, #0a1c32, #05111f);
            color: #e5e7eb;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        .dashboard-card { 
            background: linear-gradient(145deg, rgba(26, 35, 58, 0.9) 0%, rgba(16, 24, 44, 0.95) 100%);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(59, 130, 246, 0.15);
            box-shadow: 0 8px 32px rgba(2, 8, 20, 0.4);
            border-radius: 16px;
            overflow: hidden;
        }
        
        .golf-badge {
            background: linear-gradient(135deg, var(--golf-green), var(--golf-tee));
            border-radius: 20px;
            padding: 3px 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-card {
            background: rgba(17, 25, 40, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
        
        .shot-dot {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .shot-dot:hover {
            transform: scale(1.3);
            filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.8));
        }
        
        .swing-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(59, 130, 246, 0.2);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .golf-course-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(42, 157, 143, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(233, 196, 106, 0.1) 0%, transparent 25%),
                linear-gradient(to bottom, transparent 0%, rgba(10, 126, 54, 0.05) 100%);
            pointer-events: none;
            z-index: -1;
        }
        
        .performance-gauge {
            width: 100%;
            height: 20px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .gauge-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease-out;
        }
        
        .recommendation-card {
            background: rgba(26, 35, 58, 0.7);
            border-left: 4px solid var(--golf-tee);
            border-radius: 0 10px 10px 0;
            transition: all 0.3s ease;
        }
        
        .recommendation-card:hover {
            background: rgba(33, 44, 70, 0.8);
            transform: translateX(5px);
        }
        
        .grid-target {
            background: 
                radial-gradient(circle at center, rgba(10, 126, 54, 0.2) 0%, transparent 70%),
                linear-gradient(to right, transparent 49%, rgba(255,255,255,0.1) 50%, transparent 51%),
                linear-gradient(to bottom, transparent 49%, rgba(255,255,255,0.1) 50%, transparent 51%);
        }
        
        .swing-plane {
            position: relative;
            height: 180px;
            perspective: 1000px;
        }
        
        .swing-plane-inner {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transform: rotateX(60deg) rotateZ(-15deg);
        }
        
        .swing-path-line {
            stroke-linecap: round;
            stroke-width: 2;
        }
        @keyframes ballFlight {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(100px, -100px) scale(0.5); opacity: 0; }
        }

        #golf-ball {
            transition: transform 0.1s ease-out;
        }

        #impact-flash {
            transition: all 0.2s ease-out;
        }
        .quality-badge {
            font-size: 0.7rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 12px;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden">
    <div class="golf-course-bg"></div>
    <div id="root">
        <div class="flex flex-col items-center justify-center h-screen">
            <div class="flex flex-col items-center">
                <div class="loading-spinner mb-4"></div>
                <div class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-300 mb-2">
                    Analyzing Your Golf Shots
                </div>
                <p class="text-slate-400 max-w-md text-center">
                    Crunching data from your 7-iron shots to create personalized insights...
                </p>
            </div>
        </div>
    </div>
    <script type="text/babel">
        function App() {
            const [data, setData] = React.useState(null);
            const [stats, setStats] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);
            const [selectedShot, setSelectedShot] = React.useState(null);
            const [activeTab, setActiveTab] = React.useState('overview');
            
            React.useEffect(() => {
                Papa.parse('7iron3.csv', {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true,
                    complete: function(results) {
                        let validData = results.data
                            .filter(row => row['Carry Distance'] && !isNaN(row['Carry Distance']))
                            .map((row, index) => ({
                                index: index + 1,
                                CarryDistance: row['Carry Distance'],
                                TotalDistance: row['Total Distance'],
                                BallSpeed: row['Ball Speed'],
                                LaunchAngle: row['Launch Angle'],
                                LaunchDirection: row['Launch Direction'],
                                Apex: row['Apex'],
                                SideCarry: row['Side Carry'],
                                ClubSpeed: row['Club Speed'],
                                SmashFactor: row['Smash Factor'],
                                DescentAngle: row['Descent Angle'],
                                AttackAngle: row['Attack Angle'],
                                ClubPath: row['Club Path'],
                                SpinRate: row['Spin Rate'],
                                SpinAxis: row['Spin Axis']
                            }));
                        
                        const carryDistances = validData.map(shot => shot.CarryDistance).filter(val => typeof val === 'number' && !isNaN(val));
                        const mean = carryDistances.reduce((a, b) => a + b, 0) / carryDistances.length;
                        const stdDev = Math.sqrt(carryDistances.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / carryDistances.length);
                        
                        const filteredData = validData.filter(shot => {
                            if (isNaN(shot.CarryDistance) || isNaN(mean) || isNaN(stdDev) || stdDev === 0) {
                                return true;
                            }
                            const zScore = Math.abs(shot.CarryDistance - mean) / stdDev;
                            return zScore <= 1.5;
                        });
                        
                        setData(filteredData);
                        const calculatedStats = calculateStats(filteredData);
                        setStats(calculatedStats);
                        setLoading(false);
                    },
                    error: function(error) {
                        setError(error);
                        setLoading(false);
                    }
                });
            }, []);
            
            if (loading) {
                return (
                    <div class="flex flex-col items-center justify-center h-screen">
                        <div class="flex flex-col items-center">
                            <div class="loading-spinner mb-4"></div>
                            <div class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-300 mb-2">
                                Analyzing Your Golf Shots
                            </div>
                            <p class="text-slate-400 max-w-md text-center">
                                Crunching data from your 7-iron shots to create personalized insights...
                            </p>
                        </div>
                    </div>
                );
            }
            
            if (error || !stats) {
                return (
                    <div class="flex flex-col items-center justify-center h-screen p-4">
                        <div class="bg-red-900/30 border border-red-700 rounded-xl p-6 max-w-md text-center">
                            <div class="text-5xl mb-4 text-red-400">⛔</div>
                            <h2 class="text-2xl font-bold text-red-300 mb-2">Data Loading Error</h2>
                            <p class="text-slate-300 mb-4">
                                {error ? "We couldn't load your shot data." : "There was an issue processing your shot data."}
                                Please try again later.
                            </p>
                            <button 
                                class="px-4 py-2 bg-red-700 hover:bg-red-600 rounded-lg font-medium transition-colors"
                                onClick={() => window.location.reload()}
                            >
                                Retry
                            </button>
                        </div>
                    </div>
                );
            }
            
            return (
                <div class="container mx-auto px-4 py-8 max-w-7xl">
                    <header class="mb-10 text-center">
                        <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-300">
                            <i class="fas fa-golf-ball mr-3"></i>7-Iron Performance Analysis
                        </h1>
                        <p class="text-slate-400 max-w-2xl mx-auto">
                            Detailed insights from {stats.count} shots. Your average carry: <span class="text-green-400 font-bold">{stats.carryDistance.avg.toFixed(1)}</span> yards with 
                            <span class="text-amber-400 font-bold"> ±{stats.carryDistance.stdDev.toFixed(1)}</span> yards consistency.
                        </p>
                        <div class="flex justify-center gap-2 mt-4">
                            <span class="golf-badge">
                                <i class="fas fa-bullseye"></i> Dispersion: {stats.dispersionScore.toFixed(0)}/100
                            </span>
                            <span class="golf-badge bg-gradient-to-r from-amber-500 to-amber-600">
                                <i class="fas fa-fire"></i> Smash Factor: {stats.smashFactor.avg.toFixed(2)}
                            </span>
                            <span class="golf-badge bg-gradient-to-r from-blue-500 to-indigo-600">
                                <i class="fas fa-wind"></i> Spin Rate: {stats.spinRate.avg.toFixed(0)} rpm
                            </span>
                        </div>
                    </header>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-5 mb-8">
                        <div class="stat-card p-5 fade-in" style={{animationDelay: "0.1s"}}>
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-slate-400 text-sm">Carry Distance</div>
                                    <div class="text-2xl font-bold text-white mt-1">{stats.carryDistance.avg.toFixed(1)}<span class="text-slate-500 text-lg"> yds</span></div>
                                </div>
                                <i class="fas fa-arrows-alt-h text-green-400 text-xl"></i>
                            </div>
                            <div class="mt-3 text-xs text-slate-400">
                                Consistency: <span class="font-bold text-amber-400">{stats.carryDistance.stdDev.toFixed(1)} yds</span>
                            </div>
                            <div class="performance-gauge mt-2">
                                <div class="gauge-fill bg-gradient-to-r from-green-500 to-cyan-400" style={{width: `${(100 - stats.carryDistance.stdDev * 2).toFixed(0)}%`}}></div>
                            </div>
                        </div>
                        
                        <div class="stat-card p-5 fade-in" style={{animationDelay: "0.2s"}}>
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-slate-400 text-sm">Accuracy</div>
                                    <div class="text-2xl font-bold text-white mt-1">{stats.accuracyScore.toFixed(0)}<span class="text-slate-500 text-lg"> /100</span></div>
                                </div>
                                <i class="fas fa-bullseye text-amber-400 text-xl"></i>
                            </div>
                            <div class="mt-3 text-xs text-slate-400">
                                Avg. Miss: <span class="font-bold text-amber-400">{stats.sideCarryAbs.avg.toFixed(1)} yds</span>
                            </div>
                            <div class="performance-gauge mt-2">
                                <div class="gauge-fill bg-gradient-to-r from-amber-500 to-yellow-400" style={{width: `${stats.accuracyScore.toFixed(0)}%`}}></div>
                            </div>
                        </div>
                        
                        <div class="stat-card p-5 fade-in" style={{animationDelay: "0.3s"}}>
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-slate-400 text-sm">Strike Quality</div>
                                    <div class="text-2xl font-bold text-white mt-1">{stats.smashQuality.toFixed(0)}<span class="text-slate-500 text-lg"> /100</span></div>
                                </div>
                                <i class="fas fa-fire text-red-400 text-xl"></i>
                            </div>
                             <div class="mt-3 text-xs text-slate-400 flex justify-between items-center">
                                <span>Avg. Smash: <span class="font-bold text-amber-400">{stats.smashFactor.avg.toFixed(2)}</span></span>
                                <QualityBadge quality={getSmashFactorQuality(stats.smashFactor.avg).label} />
                            </div>
                            <div class="performance-gauge mt-2">
                                <div class="gauge-fill bg-gradient-to-r from-red-500 to-orange-400" style={{width: `${stats.smashQuality.toFixed(0)}%`}}></div>
                            </div>
                        </div>
                        
                        <div class="stat-card p-5 fade-in" style={{animationDelay: "0.4s"}}>
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-slate-400 text-sm">Overall Rating</div>
                                    <div class="text-2xl font-bold text-white mt-1">{stats.overallRating.toFixed(0)}<span class="text-slate-500 text-lg"> /100</span></div>
                                </div>
                                <i class="fas fa-medal text-amber-300 text-xl"></i>
                            </div>
                            <div class="mt-3 text-xs text-slate-400">
                                vs. Handicap: <span class="font-bold text-green-400">+2.4</span>
                            </div>
                            <div class="performance-gauge mt-2">
                                <div class="gauge-fill bg-gradient-to-r from-indigo-500 to-purple-400" style={{width: `${stats.overallRating.toFixed(0)}%`}}></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex border-b border-slate-700 mb-8">
                        <button class={`px-4 py-2 font-medium rounded-t-lg transition-colors ${activeTab === 'overview' ? 'text-green-400 border-b-2 border-green-400 bg-slate-800' : 'text-slate-400 hover:text-slate-300'}`} onClick={() => setActiveTab('overview')}>
                            <i class="fas fa-home mr-2"></i>Overview
                        </button>
                        <button class={`px-4 py-2 font-medium rounded-t-lg transition-colors ${activeTab === 'dispersion' ? 'text-green-400 border-b-2 border-green-400 bg-slate-800' : 'text-slate-400 hover:text-slate-300'}`} onClick={() => setActiveTab('dispersion')}>
                            <i class="fas fa-bullseye mr-2"></i>Dispersion
                        </button>
                        <button class={`px-4 py-2 font-medium rounded-t-lg transition-colors ${activeTab === 'swing' ? 'text-green-400 border-b-2 border-green-400 bg-slate-800' : 'text-slate-400 hover:text-slate-300'}`} onClick={() => setActiveTab('swing')}>
                            <i class="fas fa-golf-ball mr-2"></i>Swing Analysis
                        </button>
                        <button class={`px-4 py-2 font-medium rounded-t-lg transition-colors ${activeTab === 'recommend' ? 'text-green-400 border-b-2 border-green-400 bg-slate-800' : 'text-slate-400 hover:text-slate-300'}`} onClick={() => setActiveTab('recommend')}>
                            <i class="fas fa-lightbulb mr-2"></i>Recommendations
                        </button>
                    </div>
                    
                    <div class="mb-10">
                        {activeTab === 'overview' && <OverviewTab stats={stats} data={data} />}
                        {activeTab === 'dispersion' && <DispersionTab stats={stats} data={data} setSelectedShot={setSelectedShot} />}
                        {activeTab === 'swing' && <SwingTab stats={stats} />}
                        {activeTab === 'recommend' && <RecommendationsTab stats={stats} />}
                    </div>
                    
                    {selectedShot && (
                        <div class="dashboard-card p-6 mb-10 fade-in">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-xl font-bold text-green-400"><i class="fas fa-crosshairs mr-2"></i>Shot # {selectedShot.index} Details</h3>
                                <button class="text-slate-400 hover:text-slate-300" onClick={() => setSelectedShot(null)}><i class="fas fa-times"></i></button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h4 class="text-slate-400 text-sm mb-2">Distance Metrics</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between"><span>Carry Distance:</span><span class="font-bold">{selectedShot.CarryDistance} yds</span></div>
                                        <div class="flex justify-between"><span>Total Distance:</span><span class="font-bold">{selectedShot.TotalDistance} yds</span></div>
                                        <div class="flex justify-between"><span>Side Carry:</span><span class="font-bold">{selectedShot.SideCarry > 0 ? '+' : ''}{selectedShot.SideCarry.toFixed(1)} yds</span></div>
                                    </div>
                                </div>
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h4 class="text-slate-400 text-sm mb-2">Swing Metrics</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between"><span>Club Speed:</span><span class="font-bold">{selectedShot.ClubSpeed} mph</span></div>
                                        <div class="flex justify-between"><span>Smash Factor:</span><span class="font-bold" style={{color: getSmashColor(selectedShot.SmashFactor)}}>{selectedShot.SmashFactor.toFixed(2)}</span></div>
                                        <div class="flex justify-between"><span>Attack Angle:</span><span class="font-bold">{selectedShot.AttackAngle.toFixed(1)}°</span></div>
                                    </div>
                                </div>
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h4 class="text-slate-400 text-sm mb-2">Ball Flight</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between"><span>Launch Angle:</span><span class="font-bold">{selectedShot.LaunchAngle.toFixed(1)}°</span></div>
                                        <div class="flex justify-between"><span>Spin Rate:</span><span class="font-bold">{selectedShot.SpinRate.toFixed(0)} rpm</span></div>
                                        <div class="flex justify-between"><span>Peak Height:</span><span class="font-bold">{selectedShot.Apex.toFixed(1)} ft</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    <footer class="pt-8 border-t border-slate-700 mt-10 text-center">
                        <div class="text-lg text-slate-300 mb-4">
                            <span class="font-bold text-amber-300">Consistency</span> + <span class="font-bold text-green-400">Precision</span> + <span class="font-bold text-cyan-400">Power</span> = <span class="font-bold text-white">LOWER SCORES</span>
                        </div>
                        <div class="text-slate-500 text-sm">
                            Analysis generated at {new Date().toLocaleTimeString()} • Blockhead Golf Analytics
                        </div>
                    </footer>
                </div>
            );
        }
        
        function QualityBadge({ quality }) {
            const qualityStyles = {
                Great: 'bg-green-500/20 text-green-300', Good: 'bg-cyan-500/20 text-cyan-300',
                Average: 'bg-amber-500/20 text-amber-300', Bad: 'bg-orange-500/20 text-orange-300',
                Horrible: 'bg-red-500/20 text-red-300', Default: 'bg-slate-600/20 text-slate-300'
            };
            const style = qualityStyles[quality] || qualityStyles.Default;
            return <span className={`quality-badge ${style}`}>{quality}</span>;
        }

        function OverviewTab({ stats, data }) {
            const metricsForTable = [
                { label: "Carry Distance (yds)", path: "carryDistance", precision: 1 }, { label: "Total Distance (yds)", path: "totalDistance", precision: 1 },
                { label: "Ball Speed (mph)", path: "ballSpeed", precision: 1 }, { label: "Club Speed (mph)", path: "clubSpeed", precision: 1 },
                { label: "Smash Factor", path: "smashFactor", precision: 2 }, { label: "Launch Angle (°)", path: "launchAngle", precision: 1 },
                { label: "Spin Rate (rpm)", path: "spinRate", precision: 0 }, { label: "Apex (ft)", path: "apex", precision: 1 },
                { label: "Attack Angle (°)", path: "attackAngle", precision: 1 }, { label: "Club Path (°)", path: "clubPath", precision: 1 },
                { label: "Descent Angle (°)", path: "descentAngle", precision: 1 }, { label: "Side Carry (yds)", path: "sideCarry", precision: 1 },
            ];

            return (
                <div class="space-y-8">
                    <div class="dashboard-card p-6 fade-in">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-xl font-bold text-cyan-300 mb-4"><i class="fas fa-chart-line mr-2"></i>Performance Summary</h3>
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div class="bg-slate-800/40 rounded-lg p-4"><div class="text-slate-400 text-sm mb-1">Consistency Score</div><div class="text-2xl font-bold text-green-400">{stats.consistencyScore.toFixed(0)}/100</div><div class="text-xs text-slate-500 mt-1">Distance + Accuracy</div></div>
                                    <div class="bg-slate-800/40 rounded-lg p-4"><div class="text-slate-400 text-sm mb-1">Strokes Gained</div><div class="text-2xl font-bold text-purple-400">+0.42</div><div class="text-xs text-slate-500 mt-1">vs. 10 Handicap</div></div>
                                </div>
                                <h4 class="text-slate-400 font-bold mb-2">Miss Pattern Analysis</h4>
                                <div class="space-y-3">
                                  <div class="flex items-center gap-4"><div class="flex-1"><div class="flex justify-between text-xs text-slate-400 mb-1"><span>Left Miss</span><span>{stats.missLeft.toFixed(0)}%</span></div><div class="w-full h-2 bg-slate-700 rounded-full"><div class="h-full bg-blue-500 rounded-full" style={{width: `${stats.missLeft.toFixed(0)}%`}}></div></div></div><div class="flex-1"><div class="flex justify-between text-xs text-slate-400 mb-1"><span>Right Miss</span><span>{stats.missRight.toFixed(0)}%</span></div><div class="w-full h-2 bg-slate-700 rounded-full"><div class="h-full bg-red-500 rounded-full" style={{width: `${stats.missRight.toFixed(0)}%`}}></div></div></div></div>
                                  <div class="flex items-center gap-4"><div class="flex-1"><div class="flex justify-between text-xs text-slate-400 mb-1"><span>Short Miss</span><span>{stats.missShort.toFixed(0)}%</span></div><div class="w-full h-2 bg-slate-700 rounded-full"><div class="h-full bg-yellow-500 rounded-full" style={{width: `${stats.missShort.toFixed(0)}%`}}></div></div></div><div class="flex-1"><div class="flex justify-between text-xs text-slate-400 mb-1"><span>Long Miss</span><span>{stats.missLong.toFixed(0)}%</span></div><div class="w-full h-2 bg-slate-700 rounded-full"><div class="h-full bg-green-500 rounded-full" style={{width: `${stats.missLong.toFixed(0)}%`}}></div></div></div></div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-amber-300 mb-4"><i class="fas fa-trophy mr-2"></i>Top Performers</h3>
                                <div class="space-y-4">
                                    <div class="bg-slate-800/40 rounded-lg p-4"><div class="flex justify-between items-center"><div><div class="text-amber-400 font-bold">Longest Carry</div><div class="text-2xl font-bold text-white">{stats.maxCarry.toFixed(1)} yds</div></div><div class="text-xs bg-amber-900/40 text-amber-300 px-2 py-1 rounded">Shot #{stats.bestCarry.index}</div></div></div>
                                    <div class="bg-slate-800/40 rounded-lg p-4"><div class="flex justify-between items-center"><div><div class="text-green-400 font-bold">Most Accurate</div><div class="text-2xl font-bold text-white">±{stats.minSide.toFixed(1)} yds</div></div><div class="text-xs bg-green-900/40 text-green-300 px-2 py-1 rounded">Shot #{stats.bestAccuracy.index}</div></div></div>
                                    <div class="bg-slate-800/40 rounded-lg p-4"><div class="flex justify-between items-center"><div><div class="text-red-400 font-bold">Best Strike (Smash)</div><div class="text-2xl font-bold text-white">{stats.maxSmash.toFixed(2)}</div></div><div class="text-xs bg-red-900/40 text-red-300 px-2 py-1 rounded">Shot #{stats.bestSmash.index}</div></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card p-6 fade-in" style={{animationDelay: "0.1s"}}>
                         <h3 class="text-xl font-bold text-purple-300 mb-2"><i class="fas fa-check-double mr-2"></i>Shot Quality Probabilities</h3>
                         <p class="text-sm text-slate-400 mb-6">Likelihood of achieving key consistency metrics.</p>
                         <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-5">
                            <div class="bg-slate-800/40 rounded-xl p-4 text-center"><div class="text-4xl font-bold text-cyan-300 mb-2">{stats.distanceControlProb.toFixed(1)}%</div><div class="text-slate-300 text-sm">Distance Control</div><div class="text-slate-500 text-xs mt-1">(±10 yds of avg)</div></div>
                            <div class="bg-slate-800/40 rounded-xl p-4 text-center"><div class="text-4xl font-bold text-green-300 mb-2">{stats.accuracyProb.toFixed(1)}%</div><div class="text-slate-300 text-sm">Accuracy</div><div class="text-slate-500 text-xs mt-1">(±15 yds side)</div></div>
                            <div class="bg-slate-800/40 rounded-xl p-4 text-center"><div class="text-4xl font-bold text-red-400 mb-2">{stats.highEfficiencyProb.toFixed(1)}%</div><div class="text-slate-300 text-sm">High Efficiency</div><div class="text-slate-500 text-xs mt-1">(Smash ≥ 1.40)</div></div>
                            <div class="bg-slate-800/40 rounded-xl p-4 text-center"><div class="text-4xl font-bold text-amber-300 mb-2">{stats.stockShotProbNew.toFixed(1)}%</div><div class="text-slate-300 text-sm">"Stock Shot"</div><div class="text-slate-500 text-xs mt-1">(Good Dist & Acc)</div></div>
                         </div>
                    </div>

                    <div className="dashboard-card p-6 fade-in" style={{ animationDelay: "0.2s" }}>
                        <h3 className="text-xl font-bold text-green-300 mb-2"><i className="fas fa-flag-checkered mr-2"></i>GIR Probabilities by Distance</h3>
                        <p className="text-sm text-slate-400 mb-6">Your probability of hitting a standard green from specific yardages, based on your shot pattern within ±1.5 standard deviations.</p>
                        <div className="space-y-4">
                            {stats.girProbabilities.map((prob, i) => {
                                const probValue = prob.probability;
                                let barColorClass = 'bg-red-500';
                                if (probValue > 65) barColorClass = 'bg-green-500';
                                else if (probValue > 40) barColorClass = 'bg-amber-500';
                                return (
                                    <div key={i} className="flex items-center gap-4">
                                        <div className="w-28 text-right pr-4 text-slate-300 font-medium">{prob.distance} yds</div>
                                        <div className="flex-1"><div className="w-full h-4 bg-slate-700 rounded-full overflow-hidden"><div className={`h-full ${barColorClass} rounded-full transition-all duration-500`} style={{width: `${probValue}%`}}></div></div></div>
                                        <div className="w-16 text-left pl-3 font-bold text-white">{probValue.toFixed(0)}%</div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div class="dashboard-card p-6 fade-in" style={{animationDelay: "0.3s"}}>
                        <h3 class="text-xl font-bold text-lime-300 mb-4"><i class="fas fa-table mr-2"></i>Descriptive Statistics</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-slate-700">
                                <thead class="bg-slate-800/50"><tr><th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Metric</th><th class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Average</th><th class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Std Dev</th><th class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Min</th><th class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Max</th></tr></thead>
                                <tbody class="divide-y divide-slate-700/50">
                                    {metricsForTable.map(metric => {
                                        const statData = stats[metric.path];
                                        if (!statData || typeof statData !== 'object') return null;
                                        return (<tr key={metric.label} class="hover:bg-slate-800/30 transition-colors"><td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-slate-200">{metric.label}</td><td class="px-4 py-3 whitespace-nowrap text-sm text-slate-300 text-right">{!isNaN(statData.avg) ? statData.avg.toFixed(metric.precision) : 'N/A'}</td><td class="px-4 py-3 whitespace-nowrap text-sm text-slate-300 text-right">{!isNaN(statData.stdDev) ? statData.stdDev.toFixed(metric.precision) : 'N/A'}</td><td class="px-4 py-3 whitespace-nowrap text-sm text-slate-300 text-right">{!isNaN(statData.min) ? statData.min.toFixed(metric.precision) : 'N/A'}</td><td class="px-4 py-3 whitespace-nowrap text-sm text-slate-300 text-right">{!isNaN(statData.max) ? statData.max.toFixed(metric.precision) : 'N/A'}</td></tr>);
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }
        
        function DispersionTab({ stats, data, setSelectedShot }) {
            const [filter, setFilter] = React.useState('all');
            const filteredShots = data.filter(shot => {
                if (filter === 'all') return true;
                const quality = getSmashFactorQuality(shot.SmashFactor).label.toLowerCase();
                return filter === quality;
            });
            
            return (
                <div class="space-y-8">
                    <div class="dashboard-card p-6 fade-in">
                        <h3 class="text-xl font-bold text-amber-300 mb-4"><i class="fas fa-bullseye mr-2"></i>Shot Dispersion</h3>
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="md:w-2/3">
                                <div class="flex gap-2 mb-4 items-center flex-wrap">
                                    <div class="text-slate-400 text-sm font-medium mr-2">Filter by Strike:</div>
                                    <button class={`px-3 py-1 text-xs rounded-full ${filter === 'all' ? 'bg-blue-500 text-white' : 'bg-slate-700 text-slate-300'}`} onClick={() => setFilter('all')}>All</button>
                                    <button class={`px-3 py-1 text-xs rounded-full ${filter === 'great' ? 'bg-green-500 text-white' : 'bg-slate-700 text-slate-300'}`} onClick={() => setFilter('great')}>Great</button>
                                    <button class={`px-3 py-1 text-xs rounded-full ${filter === 'good' ? 'bg-cyan-500 text-white' : 'bg-slate-700 text-slate-300'}`} onClick={() => setFilter('good')}>Good</button>
                                    <button class={`px-3 py-1 text-xs rounded-full ${filter === 'average' ? 'bg-amber-500 text-white' : 'bg-slate-700 text-slate-300'}`} onClick={() => setFilter('average')}>Average</button>
                                    <button class={`px-3 py-1 text-xs rounded-full ${filter === 'bad' ? 'bg-orange-500 text-white' : 'bg-slate-700 text-slate-300'}`} onClick={() => setFilter('bad')}>Bad</button>
                                    <button class={`px-3 py-1 text-xs rounded-full ${filter === 'horrible' ? 'bg-red-600 text-white' : 'bg-slate-700 text-slate-300'}`} onClick={() => setFilter('horrible')}>Horrible</button>
                                </div>
                                <div class="grid-target rounded-xl overflow-hidden h-96 relative border border-slate-700">
                                    <div class="absolute inset-0 flex items-center justify-center"><div class="w-full h-px bg-slate-600/50"></div><div class="h-full w-px bg-slate-600/50"></div></div>
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border border-slate-600/50" style={{width: '160px', height: '160px'}}></div>
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border border-slate-600/50" style={{width: '240px', height: '240px'}}></div>
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border border-slate-600/50" style={{width: '320px', height: '320px'}}></div>
                                    {filteredShots.map(shot => (
                                        <div key={shot.index} class="absolute shot-dot w-3 h-3 rounded-full cursor-pointer" style={{left: `calc(50% + ${shot.SideCarry * 3}px)`, bottom: `calc(50% + ${(shot.CarryDistance - stats.carryDistance.avg) * 3}px - 6px)`, backgroundColor: getSmashFactorQuality(shot.SmashFactor).color, transform: `scale(${0.8 + (shot.SmashFactor - 1.25) / 0.2})`}} onClick={() => setSelectedShot(shot)}></div>
                                    ))}
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"><i class="fas fa-flag text-red-500 text-lg"></i></div>
                                </div>
                                <div class="flex justify-center gap-4 mt-4 text-xs text-slate-400 flex-wrap">
                                    <div class="flex items-center"><div class="w-2.5 h-2.5 rounded-full mr-2" style={{backgroundColor: getSmashFactorQuality(1.39).color}}></div>Great (1.39+)</div>
                                    <div class="flex items-center"><div class="w-2.5 h-2.5 rounded-full mr-2" style={{backgroundColor: getSmashFactorQuality(1.35).color}}></div>Good (1.35-1.38)</div>
                                    <div class="flex items-center"><div class="w-2.5 h-2.5 rounded-full mr-2" style={{backgroundColor: getSmashFactorQuality(1.31).color}}></div>Avg (1.31-1.34)</div>
                                    <div class="flex items-center"><div class="w-2.5 h-2.5 rounded-full mr-2" style={{backgroundColor: getSmashFactorQuality(1.30).color}}></div>Bad ({'<'}1.31)</div>
                                </div>
                            </div>
                            <div class="md:w-1/3">
                                <h4 class="text-lg font-bold text-cyan-300 mb-4">Dispersion Analysis</h4>
                                <div class="space-y-4">
                                    <div><div class="flex justify-between mb-1 text-slate-400"><span>Front-to-Back Spread</span><span>{(stats.carryDistance.max - stats.carryDistance.min).toFixed(1)} yds</span></div><div class="w-full h-2 bg-slate-700 rounded-full"><div class="h-full bg-gradient-to-r from-cyan-500 to-blue-500" style={{width: `${Math.max(100 - (stats.carryDistance.max - stats.carryDistance.min), 0)}%`}}></div></div></div>
                                    <div><div class="flex justify-between mb-1 text-slate-400"><span>Left-to-Right Spread</span><span>{Math.abs(stats.sideCarry.max - stats.sideCarry.min).toFixed(1)} yds</span></div><div class="w-full h-2 bg-slate-700 rounded-full"><div class="h-full bg-gradient-to-r from-amber-500 to-yellow-500" style={{width: `${Math.max(100 - Math.abs(stats.sideCarry.max - stats.sideCarry.min), 0)}%`}}></div></div></div>
                                    <div class="bg-slate-800/40 rounded-lg p-4 mt-6"><div class="text-lg font-bold text-center text-green-400 mb-2">Dispersion Score: {stats.dispersionScore.toFixed(0)}/100</div><div class="text-xs text-slate-400 text-center">Measures how tightly grouped your shots are.</div></div>
                                    <div class="text-sm text-slate-300 mt-6"><i class="fas fa-info-circle text-blue-400 mr-2"></i>Your shots are {stats.dispersionScore > 70 ? 'well grouped' : stats.dispersionScore > 50 ? 'moderately grouped' : 'spread out'}, with {stats.missLeft > stats.missRight ? 'a tendency to miss left' : 'a tendency to miss right'}.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function SwingTab({ stats }) {
            if (!stats) return null;

            const clubPathAvg = stats.clubPath?.avg ?? 0;
            const attackAngleAvg = stats.attackAngle?.avg ?? 0;
            const clubPathQuality = getClubPathQuality(clubPathAvg);
            const attackAngleQuality = getAttackAngleQuality(attackAngleAvg);

            React.useEffect(() => {
                const swingPath = document.getElementById('swing-path');
                const replayButton = document.getElementById('replay-button');
                if(!swingPath || !replayButton) return;

                const animateSwing = () => {
                    swingPath.style.transition = 'none';
                    swingPath.style.strokeDashoffset = '1000';
                    setTimeout(() => {
                        swingPath.style.transition = 'stroke-dashoffset 1.5s ease-in-out';
                        swingPath.style.strokeDashoffset = '0';
                    }, 50);
                };
                replayButton.addEventListener('click', animateSwing);
                animateSwing(); 
                return () => replayButton.removeEventListener('click', animateSwing);
            }, [stats, clubPathAvg]);

            return (
                <div class="space-y-8">
                    <div class="dashboard-card p-6 fade-in">
                        <h3 class="text-xl font-bold text-red-400 mb-4"><i class="fas fa-golf-ball mr-2"></i>Swing Dynamics</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="bg-slate-800/40 rounded-xl p-5 flex flex-col items-center">
                                <div class="text-3xl font-bold mb-3 text-amber-400">{clubPathAvg.toFixed(1)}°</div>
                                <div class="text-lg text-slate-300 mb-2">Club Path</div>
                                <QualityBadge quality={clubPathQuality.label} />
                                <div class="w-full max-w-xs mt-4">
                                    <div class="flex justify-between text-xs text-slate-500 mb-1"><span>-5° (In-to-Out)</span><span>+5° (Out-to-In)</span></div>
                                    <div class="relative h-2 bg-slate-700 rounded-full"><div class="absolute h-2 bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 w-full"></div><div class="absolute h-4 w-0.5 bg-white top-1/2 -mt-2" style={{left: `calc(50% + ${clubPathAvg * 10}%)`}}></div></div>
                                </div>
                                <div class="mt-4 text-sm text-slate-400 text-center">{clubPathQuality.description}</div>
                            </div>
                            <div class="bg-slate-800/40 rounded-xl p-5 flex flex-col items-center">
                                <div class="text-3xl font-bold mb-3 text-cyan-400">{attackAngleAvg.toFixed(1)}°</div>
                                <div class="text-lg text-slate-300 mb-2">Attack Angle</div>
                                <QualityBadge quality={attackAngleQuality.label} />
                                <div class="w-full max-w-xs mt-4">
                                    <div class="flex justify-between text-xs text-slate-500 mb-1"><span>-7° (Steep)</span><span>+2° (Shallow)</span></div>
                                    <div class="relative h-2 bg-slate-700 rounded-full"><div class="absolute h-2 bg-gradient-to-r from-red-500 via-cyan-500 to-green-500 w-full"></div><div class="absolute h-4 w-0.5 bg-white top-1/2 -mt-2" style={{left: `calc(50% + ${(attackAngleAvg + 2.5) * 10}%)`}}></div></div>
                                </div>
                                <div class="mt-4 text-sm text-slate-400 text-center">{attackAngleQuality.description}</div>
                            </div>
                        </div>
                    </div>
                     <div class="dashboard-card p-6 fade-in" style={{animationDelay: "0.2s"}}>
                        <h3 class="text-xl font-bold text-amber-300 mb-4"><i class="fas fa-project-diagram mr-2"></i>Swing Plane Visualization</h3>
                        <div class="swing-plane">
                            <div class="swing-plane-inner">
                                <svg width="100%" height="100%" viewBox="0 0 300 180">
                                    <path d="M50,150 L150,30 L250,150" fill="none" stroke="#4b5563" stroke-width="1" stroke-dasharray="4" />
                                    <path id="swing-path" d={`M50,150 Q150,${30 + clubPathAvg * 5} 250,150`} fill="none" stroke="url(#swing-gradient)" stroke-width="3" stroke-linecap="round"/>
                                    <defs><linearGradient id="swing-gradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#3b82f6" /><stop offset="100%" stop-color="#22c55e" /></linearGradient></defs>
                                    <circle cx="150" cy="150" r="8" fill="#ffffff" />
                                </svg>
                            </div>
                        </div>
                        <div class="text-center text-slate-400 mt-4">Your swing combines a <span class="font-bold text-amber-300">{clubPathQuality.label.toLowerCase()}</span> path with an <span class="font-bold text-cyan-300">{attackAngleQuality.label.toLowerCase()}</span> attack angle.</div>
                        <div class="flex justify-center mt-4"><button id="replay-button" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium transition-colors"><i class="fas fa-sync mr-2"></i>Replay Animation</button></div>
                     </div>
                </div>
            );
        }

        function RecommendationsTab({ stats }) {
            return (
                <div class="space-y-8">
                    <div class="dashboard-card p-6 fade-in">
                        <h3 class="text-xl font-bold text-green-400 mb-4"><i class="fas fa-lightbulb mr-2"></i>Personalized Improvement Plan</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gradient-to-br from-slate-800/40 to-slate-900/70 rounded-xl p-5">
                                <div class="text-amber-400 text-lg font-bold mb-3"><i class="fas fa-bullseye mr-2"></i>Priority Focus</div>
                                <div class="text-white text-xl mb-4">{stats.priorityFocus}</div>
                                <div class="text-slate-400 text-sm">This area will give you the most significant improvement based on your data</div>
                            </div>
                            <div class="bg-gradient-to-br from-slate-800/40 to-slate-900/70 rounded-xl p-5">
                                <div class="text-cyan-400 text-lg font-bold mb-3"><i class="fas fa-tachometer-alt mr-2"></i>Estimated Potential</div>
                                <div class="text-white text-xl mb-4">{stats.potentialImprovement.toFixed(1)} Strokes/Round</div>
                                <div class="text-slate-400 text-sm">Potential improvement by addressing key issues</div>
                            </div>
                            <div class="bg-gradient-to-br from-slate-800/40 to-slate-900/70 rounded-xl p-5">
                                <div class="text-purple-400 text-lg font-bold mb-3"><i class="fas fa-calendar-alt mr-2"></i>Training Timeline</div>
                                <div class="text-white text-xl mb-4">{stats.trainingTimeline}</div>
                                <div class="text-slate-400 text-sm">Expected timeframe to see measurable improvement</div>
                            </div>
                        </div>
                        <h4 class="text-lg font-bold text-amber-300 mb-4">Actionable Recommendations</h4>
                        <div class="space-y-4">
                            {stats.recommendations.map((rec, i) => (
                                <div key={i} class="recommendation-card p-4 fade-in" style={{animationDelay: `${0.1 * i}s`}}>
                                    <div class="flex"><div class="text-amber-400 text-2xl w-10">{i+1}.</div>
                                        <div>
                                            <div class="font-bold text-white mb-1">{rec.title}</div>
                                            <div class="text-slate-400 text-sm">{rec.description}</div>
                                            <div class="flex gap-2 mt-3"><span class="text-xs px-2 py-1 bg-slate-700 rounded">{rec.difficulty}</span><span class="text-xs px-2 py-1 bg-slate-700 rounded">{rec.focusArea}</span></div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div class="dashboard-card p-6 fade-in" style={{animationDelay: "0.2s"}}>
                        <h3 class="text-xl font-bold text-blue-400 mb-4"><i class="fas fa-dumbbell mr-2"></i>Recommended Drills</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {stats.drills.map((drill, i) => (
                                <div key={i} class="bg-slate-800/40 rounded-xl p-5">
                                    <div class="flex items-start mb-4"><div class="text-3xl mr-4 text-amber-400">{i+1}</div><div><div class="font-bold text-lg text-white mb-1">{drill.name}</div><div class="text-slate-400">{drill.focus}</div></div></div>
                                    <div class="text-slate-300 mb-4">{drill.description}</div>
                                    <div class="flex gap-2">{drill.benefits.map((benefit, j) => (<span key={j} class="text-xs px-2 py-1 bg-green-900/30 text-green-300 rounded">{benefit}</span>))}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }
        
        function getSmashColor(smash) { return getSmashFactorQuality(smash).color; }
        function getSmashFactorQuality(smash) {
            if (smash >= 1.39) return { label: 'Great', color: '#34d399' };
            if (smash >= 1.35) return { label: 'Good', color: '#22d3ee' };
            if (smash >= 1.31) return { label: 'Average', color: '#f59e0b' };
            if (smash > 1.25) return { label: 'Bad', color: '#f97316' };
            return { label: 'Horrible', color: '#ef4444' };
        }
        function getClubPathQuality(path) {
            const absPath = Math.abs(path);
            if (absPath <= 1.5) return { label: 'Great', description: 'A neutral path, promoting straight shots.' };
            if (absPath <= 3.0) return { label: 'Good', description: `A slight ${path < 0 ? 'in-to-out' : 'out-to-in'} path.` };
            if (absPath <= 4.5) return { label: 'Average', description: `A moderate ${path < 0 ? 'in-to-out' : 'out-to-in'} path.` };
            return { label: 'Bad', description: `A strong ${path < 0 ? 'in-to-out' : 'out-to-in'} path.` };
        }
        function getAttackAngleQuality(angle) {
            if (angle <= -3 && angle >= -5) return { label: 'Great', description: 'Optimal downward strike, compressing the ball.' };
            if (angle < -2 && angle > -6) return { label: 'Good', description: 'A solid downward strike on the ball.' };
            if (angle <= -0.5 && angle > -7) return { label: 'Average', description: 'Slightly shallow or steep, but functional.' };
            if (angle > 0) return { label: 'Bad', description: 'Sweeping or upward strike, leading to thin shots.' };
            return { label: 'Horrible', description: 'Very steep attack, leading to heavy shots.' };
        }

        function calculateStats(shots) {
            if (!shots || shots.length === 0) return null;
            const numeric = val => typeof val === 'number' && !isNaN(val);
            const validShots = shots.filter(shot => Object.values(shot).every(val => numeric(val) || typeof val === 'number'));
            if (validShots.length === 0) return null;
            
            const sum = arr => arr.reduce((a, b) => a + b, 0);
            const avg = arr => arr.length > 0 ? sum(arr) / arr.length : NaN;
            const stdDev = arr => {
                if (arr.length < 2) return NaN;
                const mean = avg(arr);
                return Math.sqrt(arr.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / arr.length);
            };
            const min = arr => arr.length > 0 ? Math.min(...arr) : NaN;
            const max = arr => arr.length > 0 ? Math.max(...arr) : NaN;
            const roundScore = (val, decimals = 0) => !isNaN(val) ? parseFloat(val.toFixed(decimals)) : NaN;
            const prob = (count, total) => total > 0 ? (count / total) * 100 : 0;

            const carryDistances = validShots.map(s => s.CarryDistance);
            const carryAvg = avg(carryDistances);

            const distanceControlCount = validShots.filter(s => Math.abs(s.CarryDistance - carryAvg) <= 10).length;
            const accuracyCount = validShots.filter(s => Math.abs(s.SideCarry) <= 15).length;
            const highEfficiencyCount = validShots.filter(s => s.SmashFactor >= 1.40).length;
            const stockShotNewCount = validShots.filter(s => Math.abs(s.CarryDistance - carryAvg) <= 10 && Math.abs(s.SideCarry) <= 15).length;

            const statsObject = {
                count: validShots.length,
                carryDistance: { avg: carryAvg, stdDev: stdDev(carryDistances), min: min(carryDistances), max: max(carryDistances) },
                totalDistance: { avg: avg(validShots.map(s=>s.TotalDistance)), stdDev: stdDev(validShots.map(s=>s.TotalDistance)), min: min(validShots.map(s=>s.TotalDistance)), max: max(validShots.map(s=>s.TotalDistance)) },
                ballSpeed: { avg: avg(validShots.map(s=>s.BallSpeed)), stdDev: stdDev(validShots.map(s=>s.BallSpeed)), min: min(validShots.map(s=>s.BallSpeed)), max: max(validShots.map(s=>s.BallSpeed)) },
                clubSpeed: { avg: avg(validShots.map(s=>s.ClubSpeed)), stdDev: stdDev(validShots.map(s=>s.ClubSpeed)), min: min(validShots.map(s=>s.ClubSpeed)), max: max(validShots.map(s=>s.ClubSpeed)) },
                sideCarry: { avg: avg(validShots.map(s=>s.SideCarry)), stdDev: stdDev(validShots.map(s=>s.SideCarry)), min: min(validShots.map(s=>s.SideCarry)), max: max(validShots.map(s=>s.SideCarry)) },
                smashFactor: { avg: avg(validShots.map(s=>s.SmashFactor)), stdDev: stdDev(validShots.map(s=>s.SmashFactor)), min: min(validShots.map(s=>s.SmashFactor)), max: max(validShots.map(s=>s.SmashFactor)) },
                spinRate: { avg: avg(validShots.map(s=>s.SpinRate)), stdDev: stdDev(validShots.map(s=>s.SpinRate)), min: min(validShots.map(s=>s.SpinRate)), max: max(validShots.map(s=>s.SpinRate)) },
                clubPath: { avg: avg(validShots.map(s=>s.ClubPath)), stdDev: stdDev(validShots.map(s=>s.ClubPath)), min: min(validShots.map(s=>s.ClubPath)), max: max(validShots.map(s=>s.ClubPath)) },
                attackAngle: { avg: avg(validShots.map(s=>s.AttackAngle)), stdDev: stdDev(validShots.map(s=>s.AttackAngle)), min: min(validShots.map(s=>s.AttackAngle)), max: max(validShots.map(s=>s.AttackAngle)) },
                launchAngle: { avg: avg(validShots.map(s=>s.LaunchAngle)), stdDev: stdDev(validShots.map(s=>s.LaunchAngle)), min: min(validShots.map(s=>s.LaunchAngle)), max: max(validShots.map(s=>s.LaunchAngle)) },
                apex: { avg: avg(validShots.map(s=>s.Apex)), stdDev: stdDev(validShots.map(s=>s.Apex)), min: min(validShots.map(s=>s.Apex)), max: max(validShots.map(s=>s.Apex)) },
                descentAngle: { avg: avg(validShots.map(s=>s.DescentAngle)), stdDev: stdDev(validShots.map(s=>s.DescentAngle)), min: min(validShots.map(s=>s.DescentAngle)), max: max(validShots.map(s=>s.DescentAngle)) },
                sideCarryAbs: { avg: avg(validShots.map(s => Math.abs(s.SideCarry))) },
                
                distanceControlProb: prob(distanceControlCount, validShots.length),
                accuracyProb: prob(accuracyCount, validShots.length),
                highEfficiencyProb: prob(highEfficiencyCount, validShots.length),
                stockShotProbNew: prob(stockShotNewCount, validShots.length),

                bestCarry: validShots.reduce((best, shot) => (!best || shot.CarryDistance > best.CarryDistance) ? shot : best, {}),
                bestSmash: validShots.reduce((best, shot) => (!best || shot.SmashFactor > best.SmashFactor) ? shot : best, {}),
                bestAccuracy: validShots.reduce((best, shot) => (!best || Math.abs(shot.SideCarry) < Math.abs(best.SideCarry)) ? shot : best, {}),
                maxCarry: max(carryDistances),
                minSide: min(validShots.map(s => Math.abs(s.SideCarry))),
                maxSmash: max(validShots.map(s => s.SmashFactor)),
            };

            const dispersionDistances = validShots.map(shot => Math.sqrt(Math.pow(shot.CarryDistance - carryAvg, 2) + Math.pow(shot.SideCarry, 2))).filter(numeric);
            statsObject.dispersionScore = roundScore(Math.max(0, 100 - (avg(dispersionDistances) * 1.5)));
            statsObject.accuracyScore = roundScore(Math.max(0, 100 - (statsObject.sideCarryAbs.avg * 3)));
            statsObject.smashQuality = roundScore(Math.min(100, (statsObject.smashFactor.avg - 1.2) * 500));
            statsObject.overallRating = roundScore((statsObject.dispersionScore * 0.4) + (statsObject.accuracyScore * 0.3) + (statsObject.smashQuality * 0.3));
            statsObject.consistencyScore = roundScore(Math.max(0, 100 - (statsObject.carryDistance.stdDev * 2) - (statsObject.sideCarryAbs.avg * 1.5)));
            statsObject.missLeft = prob(validShots.filter(s => s.SideCarry < -5).length, validShots.length);
            statsObject.missRight = prob(validShots.filter(s => s.SideCarry > 5).length, validShots.length);
            statsObject.missShort = prob(validShots.filter(s => s.CarryDistance < carryAvg - 10).length, validShots.length);
            statsObject.missLong = prob(validShots.filter(s => s.CarryDistance > carryAvg + 10).length, validShots.length);

            statsObject.girProbabilities = (() => {
                const ranges = [ { minStd: -1.5, maxStd: -1.0 }, { minStd: -1.0, maxStd: -0.5 }, { minStd: -0.5, maxStd: 0.0 },  { minStd: 0.0, maxStd: 0.5 }, { minStd: 0.5, maxStd: 1.0 }, { minStd: 1.0, maxStd: 1.5 } ];
                const carryStdDev = statsObject.carryDistance.stdDev;
                if (isNaN(carryAvg) || isNaN(carryStdDev)) return ranges.map(r => ({ distance: "N/A", probability: 0 }));
                return ranges.map(range => {
                    const lowerBound = carryAvg + (range.minStd * carryStdDev);
                    const upperBound = carryAvg + (range.maxStd * carryStdDev);
                    const shotsInBucket = validShots.filter(s=>s.CarryDistance >= lowerBound && s.CarryDistance <= upperBound);
                    const girCount = shotsInBucket.filter(s => Math.abs(s.SideCarry) <= 15).length;
                    return { distance: `${Math.round(lowerBound)}-${Math.round(upperBound)}`, probability: roundScore(prob(girCount, shotsInBucket.length)) };
                });
            })();

            statsObject.priorityFocus = statsObject.dispersionScore < 70 ? "Accuracy & Dispersion" : statsObject.smashQuality < 70 ? "Contact Quality" : "Distance Control";
            statsObject.potentialImprovement = roundScore((100 - statsObject.overallRating) / 10, 1);
            statsObject.trainingTimeline = statsObject.overallRating > 80 ? "2-4 Weeks" : statsObject.overallRating > 60 ? "4-6 Weeks" : "6-8 Weeks";
            statsObject.recommendations = [
                { title: "Improve Strike Consistency", description: "Use impact tape during practice to monitor center-face contact. The goal is to cluster impacts in the center of the club face.", difficulty: "Moderate", focusArea: "Ball Striking" },
                { title: "Calibrate Distance Control", description: "Practice hitting shots to specific targets at 75%, 85%, and 95% of your full swing power to improve your distance gapping.", difficulty: "Moderate", focusArea: "Distance Control" },
                { title: "Develop Pre-shot Routine", description: "Create and stick to a consistent 20-second routine before every shot to improve focus and repeatability.", difficulty: "Easy", focusArea: "Mental Game" }
            ];
            statsObject.drills = [ 
                { name: "Gate Drill", focus: "Club Path & Face Control", description: "Set two alignment sticks or headcovers on the ground just wider than your clubhead. Your goal is to swing through the gate without hitting either side.", benefits: ["Better path", "Center contact"] },
                { name: "Ladder Drill", focus: "Distance Control", description: "Set targets at various distances (e.g., 140, 150, 160 yds) and try to land a ball at each 'rung' of the ladder consecutively.", benefits: ["Feel", "Yardage gapping"] }
            ];
            
            return statsObject;
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>

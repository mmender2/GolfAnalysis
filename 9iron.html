<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9-Iron Shot Analysis Report - Precision Tool (v1 - CSV Load)</title>

    <script src="https://cdn.jsdelivr.net/npm/react-datepicker@4.8.0/dist/react-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chrono-node/1.3.11/chrono.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body { background-color: #111827; color: #d1d5db; }
      .recharts-tooltip-cursor { stroke: #9ca3af; stroke-dasharray: 3 3; }
      .loading-spinner { border: 4px solid #4b5563; border-top: 4px solid #8b5cf6; /* purple-500 */ border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .error-message { color: #f87171; background-color: #4b1d1d; border: 1px solid #ef4444; padding: 1rem; margin: 1rem; border-radius: 0.5rem; font-family: sans-serif; }
      .error-message h1 { font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; }
      .error-message code { background-color: #5f2727; padding: 0.1em 0.4em; border-radius: 0.25rem; font-size: 0.9em;}
      ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #1f2937; } ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; } ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
      .prob-high { color: #4ade80; } .prob-medium { color: #facc15; } .prob-low { color: #f87171; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans">
    <div id="root">
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 80vh;">
            <div class="loading-spinner"></div>
            <p style="color: #9ca3af;">Initializing 9-Iron Report & Loading Data...</p>
        </div>
    </div>

    <script type="text/babel">
        function runApplication() {
            console.log("Checking library availability...");
            const missingLibs = []; if (typeof React === 'undefined') missingLibs.push('React'); if (typeof ReactDOM === 'undefined') missingLibs.push('ReactDOM'); if (typeof Papa === 'undefined') missingLibs.push('PapaParse'); if (typeof Recharts === 'undefined') missingLibs.push('Recharts'); if (typeof Babel === 'undefined') missingLibs.push('Babel');
            if (missingLibs.length > 0) { const m=missingLibs.join(', '); console.error(`Libs failed: ${m}`); const r=document.getElementById('root'); if(r)r.innerHTML=`<div class="error-message"><h1>Init Error</h1><p>Lib failed: <code>${m}</code>.</p><p>Check net, console (F12).</p></div>`; return; } console.log("Libs OK.");

            const { useEffect, useState, Component } = React;
            const { ResponsiveContainer, ScatterChart, CartesianGrid, XAxis, YAxis, ZAxis, Tooltip, Legend, Scatter, ReferenceLine, ReferenceArea, Cell } = Recharts;

            console.log("Script starting for 9-Iron...");
            {/* *** CHANGE: CSV File Path for 9-Iron *** */}
            const CSV_FILE_PATH = '9ir100.csv';

            function calculateStats(data, key) { /* ... Keep existing ... */ if (!data || data.length === 0) return { avg: NaN, stdDev: NaN, min: NaN, max: NaN, median: NaN }; const values = data.map(d => d[key]).filter(v => typeof v === 'number' && !isNaN(v)); if (values.length === 0) return { avg: NaN, stdDev: NaN, min: NaN, max: NaN, median: NaN }; const sum = values.reduce((a, v) => a + v, 0); const avg = sum / values.length; const sqDiffs = values.map(v => Math.pow(v - avg, 2)); const avgSqDiff = sqDiffs.reduce((a, v) => a + v, 0) / values.length; const stdDev = Math.sqrt(avgSqDiff); const min = Math.min(...values); const max = Math.max(...values); const sorted = [...values].sort((a, b) => a - b); const mid = Math.floor(sorted.length / 2); const median = sorted.length % 2 !== 0 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2; return { avg, stdDev, min, max, median }; }
            function calculateAbsStat(data, key) { /* ... Keep existing ... */ if (!data || data.length === 0) return { avg: NaN }; const values = data.map(d => Math.abs(d[key])).filter(v => typeof v === 'number' && !isNaN(v)); if (values.length === 0) return { avg: NaN }; const sum = values.reduce((a, v) => a + v, 0); const avg = sum / values.length; return { avg }; }
            function calculateGIRProbabilities(filteredData, avgCarry) { /* ... Keep existing ... */ if (!filteredData || !filteredData.length || isNaN(avgCarry)) return []; const W = 30, D = 30, HW = W / 2, HD = D / 2; const dists = [avgCarry - 15, avgCarry - 7, avgCarry, avgCarry + 7, avgCarry + 15].map(Math.round).filter(d => d > 0); /* Adjusted window for 9i */ const results = dists.map(target => { let hits = 0; filteredData.forEach(s => { const widthOK = Math.abs(s.SideCarry) <= HW; const depthOK = (s.CarryDistance >= target - HD) && (s.CarryDistance <= target + HD); if (widthOK && depthOK) hits++; }); return { distance: target, probability: (hits / filteredData.length) * 100 }; }); console.log("GIR Probs:", results); return results; }

            function calculateShotQualityProbabilities(filteredData, stats) {
                if (!filteredData || filteredData.length === 0) { console.warn("SQP: filteredData missing/empty."); return null; }
                const avgCarry = stats?.carryDistance?.avg;
                if (typeof avgCarry !== 'number' || isNaN(avgCarry)) { console.warn(`SQP: stats.carryDistance.avg invalid. Value: ${avgCarry}`); console.log("SQP Full stats:", stats); return null; }
                console.log(`Calculating 9i shot quality with avgCarry: ${avgCarry.toFixed(1)}`);

                {/* *** CHANGE: Thresholds for 9-Iron *** */}
                const DISTANCE_WINDOW_YDS = 5.0; // Tighter window for scoring clubs
                const ACCURACY_WINDOW_YDS = 7.5; // Tighter window
                const MIN_GOOD_SMASH = 1.25;     // Slightly lower "good" smash for 9i is common

                let distanceControlCount = 0, accuracyCount = 0, highSmashCount = 0, stockShotCount = 0;
                filteredData.forEach(shot => {
                    const carry = shot.CarryDistance, side = shot.SideCarry, smash = shot.SmashFactor;
                    if (typeof carry !== 'number' || isNaN(carry) || typeof side !== 'number' || isNaN(side) || typeof smash !== 'number' || isNaN(smash) ) { console.warn(`SQP Skipping shot ${shot.index}:`, shot); return; }
                    const isDistanceOk = Math.abs(carry - avgCarry) <= DISTANCE_WINDOW_YDS; if (isDistanceOk) distanceControlCount++;
                    const isAccuracyOk = Math.abs(side) <= ACCURACY_WINDOW_YDS; if (isAccuracyOk) accuracyCount++;
                    const isSmashOk = smash >= MIN_GOOD_SMASH; if (isSmashOk) highSmashCount++;
                    if (isDistanceOk && isAccuracyOk) stockShotCount++;
                });
                const totalShots = filteredData.length; if (totalShots === 0) { console.warn("SQP: Zero valid shots."); return null; }
                const results = { distanceWindow: DISTANCE_WINDOW_YDS, accuracyWindow: ACCURACY_WINDOW_YDS, smashThreshold: MIN_GOOD_SMASH, distanceControlProb: (distanceControlCount / totalShots) * 100, accuracyProb: (accuracyCount / totalShots) * 100, highSmashProb: (highSmashCount / totalShots) * 100, stockShotProb: (stockShotCount / totalShots) * 100 };
                console.log("Calculated 9i Shot Quality Probabilities:", results); return results;
            }

            const CustomTooltip = ({ active, payload, label }) => { /* ... Keep existing ... */ if (active && payload && payload.length) { const d = payload[0].payload; if (!d) return null; return ( <div className="bg-gray-700 border border-gray-600 shadow-lg rounded-md p-3 text-sm text-gray-100 opacity-95 max-w-xs"><p className="font-semibold mb-1 text-blue-300">{`Shot Index: ${d.index || 'N/A'}`}</p>{Object.entries(d).map(([k, v]) => { if (typeof v === 'number' && !isNaN(v) && !['x', 'y', 'z', 'index'].includes(k)) { let u = ''; const lk = k.toLowerCase(); if (lk.includes('distance')) u = ' yds'; else if (lk.includes('speed')) u = ' mph'; else if (lk.includes('angle')||lk.includes('direction')||lk.includes('axis')) u = ' Â°'; else if (lk.includes('spin')) u = ' rpm'; else if (lk.includes('factor')) u = ''; else if (lk.includes('apex')) u = ' ft'; else if (lk.includes('side')) u = ' yds'; const fv = lk.includes('factor') ? v.toFixed(2) : (lk.includes('spin') ? v.toFixed(0) : v.toFixed(1)); const dn = k.replace(/([A-Z])/g, ' $1').replace(/^./, s => s.toUpperCase()); return <p key={k} className="truncate">{`${dn}: ${fv}${u}`}</p>; } return null; })}</div> ); } return null; };
            {/* *** CHANGE: Smash Color for 9i (can be same as 7i, or slightly adjusted if desired) *** */}
             const getSmashColor = (value) => { if (!value || isNaN(value)) return "#6b7280"; if (value < 1.10) return "#ef4444"; if (value < 1.20) return "#f97316"; if (value < 1.28) return "#eab308"; if (value < 1.32) return "#84cc16"; return "#22c55e"; }; // Slightly adjusted for 9i expectations

            class ErrorBoundary extends Component { /* ... Keep existing ... */ constructor(props){ super(props); this.state = { hasError: false, error: null, errorInfo: null }; } static getDerivedStateFromError(error){ return { hasError: true }; } componentDidCatch(error, errorInfo){ console.error("EB caught:", error, errorInfo); this.setState({ error: error, errorInfo: errorInfo }); } render(){ if (this.state.hasError){ return ( <div className="p-4 m-4 border border-red-500 rounded bg-red-900 bg-opacity-30 text-red-300"><h1 className="text-xl font-bold mb-2 text-red-400">Component Error</h1><p>Error rendering section.</p><details className="mt-2 text-sm"><summary className="cursor-pointer text-red-400 hover:text-red-200">Details</summary><pre className="mt-1 p-2 bg-gray-800 rounded text-xs overflow-auto text-red-200">{this.state.error && this.state.error.toString()}<br/>{this.state.errorInfo && this.state.errorInfo.componentStack}</pre></details></div> ); } return this.props.children; } }

            function App() {
                const [data, setData] = useState(null);
                const [stats, setStats] = useState(null);
                const [loading, setLoading] = useState(true);
                const [error, setError] = useState(null);
                const [originalCount, setOriginalCount] = useState(0);
                const [girProbabilities, setGirProbabilities] = useState([]);
                const [shotQualityProbs, setShotQualityProbs] = useState(null);

                useEffect(() => {
                    console.log("useEffect starting data load for 9-Iron...");
                    setLoading(true); setError(null); setGirProbabilities([]); setShotQualityProbs(null);
                    fetch(CSV_FILE_PATH).then(r => { if (!r.ok) throw new Error(`HTTP ${r.status} fetching ${CSV_FILE_PATH}`); return r.text(); })
                    .then(csvText => { console.log("CSV fetched. Parsing..."); Papa.parse(csvText.trim(), { header: true, skipEmptyLines: true, dynamicTyping: true, transformHeader: h => h.trim().replace(/\s+/g, ''),
                        complete: (results) => { console.log("Parse complete."); if (results.errors.length){ console.error("Parse errors:", results.errors); setError(`Parse Error: ${results.errors[0].message}`); setLoading(false); return; } if (!results.data?.length){ setError("No data rows in CSV."); setLoading(false); return; }
                            const initialData = results.data; setOriginalCount(initialData.length); console.log(`Parsed ${initialData.length} rows.`);
                            const processedData = initialData.map((row, index) => { const nf = ['CarryDistance','TotalDistance','BallSpeed','LaunchAngle','LaunchDirection','Apex','SideCarry','ClubSpeed','SmashFactor','DescentAngle','SpinRate','SpinAxis']; const cr = { ...row, index: index + 1 }; let vld = true; nf.forEach(f => { if (typeof cr[f]!=='number'||isNaN(cr[f])){ if (['CarryDistance','SmashFactor','ClubSpeed'].includes(f)) vld = false; else cr[f]=NaN; }}); if(cr.ClubType&&!cr.ClubType.toLowerCase().includes('9i')) console.warn(`Row ${index+1} Club: ${cr.ClubType} (expected 9i)`); return vld?cr:null; }).filter(r=>r!==null); console.log(`Processed ${processedData.length} valid rows.`);
                            {/* *** CHANGE: Outlier Filtering for 9-Iron *** */}
                            const MIN_CARRY_YDS = 60; const MIN_SMASH = 1.10; const MIN_SPEED = 55;
                            const filteredData = processedData.filter(s=>s.CarryDistance>=MIN_CARRY_YDS && s.SmashFactor>=MIN_SMASH && s.ClubSpeed>=MIN_SPEED); const filteredCount = processedData.length - filteredData.length; console.log(`Filtered out ${filteredCount} outliers for 9i.`); if(filteredData.length===0){ setError(`No 9i shots remain after filtering.`); setLoading(false); return; } setData(filteredData);
                            console.log(`Calculating 9i stats on ${filteredData.length} shots...`); const calculatedStats = { carryDistance: calculateStats(filteredData, 'CarryDistance'), totalDistance: calculateStats(filteredData, 'TotalDistance'), ballSpeed: calculateStats(filteredData, 'BallSpeed'), clubSpeed: calculateStats(filteredData, 'ClubSpeed'), smashFactor: calculateStats(filteredData, 'SmashFactor'), launchAngle: calculateStats(filteredData, 'LaunchAngle'), spinRate: calculateStats(filteredData, 'SpinRate'), apex: calculateStats(filteredData, 'Apex'), sideCarry: calculateStats(filteredData, 'SideCarry'), sideCarryAbs: calculateAbsStat(filteredData, 'SideCarry'), launchDirection: calculateStats(filteredData, 'LaunchDirection'), spinAxis: calculateStats(filteredData, 'SpinAxis'), descentAngle: calculateStats(filteredData, 'DescentAngle'), count: filteredData.length, originalCount: initialData.length, filteredOutCount: filteredCount }; setStats(calculatedStats); console.log("9i Stats calculated.");
                            const girProbs = calculateGIRProbabilities(filteredData, calculatedStats.carryDistance.avg); setGirProbabilities(girProbs);
                            console.log("Calling calculateShotQualityProbabilities for 9i..."); const qualityProbs = calculateShotQualityProbabilities(filteredData, calculatedStats); console.log("Result from SQP for 9i:", qualityProbs);
                            if (qualityProbs) { setShotQualityProbs(qualityProbs); console.log("setShotQualityProbs called successfully for 9i."); } else { console.error("9i Quality calculation returned null, state not updated."); }
                            setLoading(false);
                        }, error: (err) => { console.error("Papa critical error:", err); setError(`Parse fail: ${err.message}`); setLoading(false); } });
                    }).catch(err => { console.error("Fetch/process error:", err); setError(`Load fail: ${err.message}`); setLoading(false); });
                }, []);

                 if (loading) return <div className="flex flex-col items-center justify-center h-screen"><div className="loading-spinner"></div><p className="text-2xl font-semibold text-gray-400 animate-pulse">Loading 9-Iron Data...</p></div>;
                 if (error) return <div className="p-4 m-4 border border-red-500 rounded bg-red-900 bg-opacity-30 text-red-300 max-w-2xl mx-auto"><h1 className="text-xl font-bold mb-2 text-red-400">Load Error</h1><p>{error}</p><p className="mt-2 text-sm">Ensure '{CSV_FILE_PATH}' exists & is valid. Check console (F12).</p></div>;
                 if (!data || !stats || !data.length || !stats.count) return <div className="p-4 m-4 border border-yellow-500 rounded bg-yellow-900 bg-opacity-30 text-yellow-300 max-w-2xl mx-auto"><h1 className="text-xl font-bold mb-2 text-yellow-400">Data Issue</h1><p>No valid shots after filtering.</p><p className="mt-2 text-sm">Orig: {stats?.originalCount??originalCount}. Filtered: {stats?.filteredOutCount??'N/A'}.</p></div>;

                const dispersionData = data.map(d => ({ x: d.SideCarry, y: d.CarryDistance, z: d.SmashFactor || 0, index: d.index, ...d }));
                const launchSpinData = data.map(d => ({ x: d.LaunchAngle, y: d.SpinRate, z: d.CarryDistance || 0, index: d.index, ...d }));
                const efficiencyData = data.map(d => ({ x: d.ClubSpeed, y: d.SmashFactor, z: d.CarryDistance || 0, index: d.index, ...d }));
                const getProbClass = (prob) => { if (prob >= 70) return 'prob-high'; if (prob >= 40) return 'prob-medium'; return 'prob-low'; };

                return (
                    <div className="container mx-auto p-4 md:p-8 max-w-7xl">
                        {/* *** CHANGE: Update Header & Color *** */}
                        <header className="mb-8 text-center"> <h1 className="text-4xl md:text-5xl font-extrabold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500"> 9-Iron Precision Analysis </h1> <p className="text-lg text-gray-400"> {stats.count} Shots Analyzed ({stats.filteredOutCount > 0 ? `${stats.filteredOutCount} outliers removed, ` : ''}from {stats.originalCount} total): Sharpen Your Scoring Club </p> </header>

                        {/* Summary Section */}
                        <ErrorBoundary><section className="mb-10 bg-gray-800 p-6 rounded-xl shadow-2xl border border-gray-700"> {/* *** CHANGE: Update Color *** */} <h2 className="text-2xl font-bold mb-4 text-purple-400 border-b border-purple-700 pb-2">Executive Summary: 9-Iron</h2> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4 text-base"> {/* ... (Keep summary divs, data updates automatically) ... */} <div><p className="font-semibold text-pink-300 mb-1">Dist (Carry):</p><p>Avg: <strong className="text-white">{stats.carryDistance.avg.toFixed(1)} yds</strong></p><p>Med: <strong className="text-gray-300">{stats.carryDistance.median.toFixed(1)} yds</strong></p><p>Range: <strong className="text-gray-300">{stats.carryDistance.min.toFixed(1)}-{stats.carryDistance.max.toFixed(1)} yds</strong></p><p>StdDev: <strong className={stats.carryDistance.stdDev > 8 ? "text-red-400" : "text-yellow-400"}>{stats.carryDistance.stdDev.toFixed(1)} yds</strong></p></div><div><p className="font-semibold text-orange-300 mb-1">Accuracy/Efficiency:</p><p>Avg Side Miss: <strong className="text-white">{stats.sideCarryAbs.avg.toFixed(1)} yds</strong></p><p>Side Range: <strong className="text-gray-300">{stats.sideCarry.min.toFixed(1)} to {stats.sideCarry.max.toFixed(1)} yds</strong></p><p>Avg Smash: <strong className="text-white">{stats.smashFactor.avg.toFixed(2)}</strong></p><p>Smash StdDev: <strong className={stats.smashFactor.stdDev > 0.07 ? "text-red-400" : "text-yellow-400"}>{stats.smashFactor.stdDev.toFixed(2)}</strong></p></div><div><p className="font-semibold text-sky-300 mb-1">Engine:</p><p>Avg Club Spd: <strong className="text-white">{stats.clubSpeed.avg.toFixed(1)} mph</strong></p><p>Avg Ball Spd: <strong className="text-white">{stats.ballSpeed.avg.toFixed(1)} mph</strong></p><p>Avg Launch: <strong className="text-gray-300">{stats.launchAngle.avg.toFixed(1)}Â°</strong></p><p>Avg Spin: <strong className="text-gray-300">{(stats.spinRate.avg/1000).toFixed(1)}k rpm</strong></p></div></div> </section></ErrorBoundary>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                            <ErrorBoundary><div className="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700"><h3 className="text-xl font-semibold mb-4 text-center text-pink-300">Dispersion (Carry) - 9i</h3><ResponsiveContainer width="100%" height={400}><ScatterChart margin={{ top: 20, right: 30, bottom: 40, left: 20 }}><CartesianGrid/><XAxis type="number" dataKey="x" name="Side Carry" unit=" yds" label={{ value: "â Left | Side (yds) | Right â", position: 'insideBottom', offset: -25, fill: '#9ca3af' }} stroke="#9ca3af" domain={['auto', 'auto']} tick={{ fill: '#d1d5db' }} reversed={false} tickFormatter={(v)=>`${v>0?'+':''}${v.toFixed(0)}`}/><YAxis type="number" dataKey="y" name="Carry Dist" unit=" yds" label={{ value:'Carry (yds)', angle: -90, position: 'insideLeft', offset: -5, fill:'#9ca3af'}} stroke="#9ca3af" domain={[0, 'dataMax + 10']} tick={{ fill: '#d1d5db' }}/><ZAxis type="number" dataKey="z" name="Smash" range={[40, 300]} /><Tooltip content={<CustomTooltip />}/><Scatter name="9i Shots" data={dispersionData} shape="circle">{dispersionData.map((e, i)=>(<Cell key={`c-${i}`} fill={getSmashColor(e.SmashFactor)}/>))}</Scatter><ReferenceLine x={0} stroke="#f87171" strokeWidth={2} label={{ value:'Target', position:'top', fill:'#f87171', fontSize:10}}/><ReferenceLine y={stats.carryDistance.avg} stroke="#60a5fa" strokeDasharray="4 1" label={{ value:`Avg Carry (${stats.carryDistance.avg.toFixed(0)}y)`, position:'insideTopRight', fill:'#60a5fa', fontSize:10, dy:-5}}/><ReferenceLine x={stats.sideCarry.avg} stroke="#facc15" strokeDasharray="4 1" label={{ value:`Avg Side (${stats.sideCarry.avg.toFixed(1)}y)`, position:'insideBottomRight', fill:'#facc15', fontSize:10, dy:10}}/></ScatterChart></ResponsiveContainer><p className="text-xs text-center text-gray-400 mt-2 px-4">Color=Smash Factor. Size=Smash Factor.</p></div></ErrorBoundary>
                            <ErrorBoundary><div className="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700"><h3 className="text-xl font-semibold mb-4 text-center text-pink-300">Launch vs. Spin - 9i</h3><ResponsiveContainer width="100%" height={400}><ScatterChart margin={{ top: 20, right: 20, bottom: 40, left: 20 }}><CartesianGrid/><XAxis type="number" dataKey="x" name="Launch" unit="Â°" label={{ value:"Launch Angle (Â°)", position:'insideBottom', offset:-25, fill:'#9ca3af'}} stroke="#9ca3af" domain={[5, 'dataMax+2']} tick={{ fill:'#d1d5db' }}/><YAxis type="number" dataKey="y" name="Spin" unit=" rpm" label={{ value:'Spin (rpm)', angle:-90, position:'insideLeft', offset:0, fill:'#9ca3af'}} stroke="#9ca3af" domain={[2000,'dataMax+500']} tickFormatter={(t)=>t>=1000?`${(t/1000).toFixed(1)}k`:t} tick={{ fill:'#d1d5db' }}/><ZAxis type="number" dataKey="z" name="Carry" range={[30, 250]}/><Tooltip content={<CustomTooltip />}/><Scatter name="L/S" data={launchSpinData} fill="#ec4899" shape="circle">{launchSpinData.map((e,i)=>(<Cell key={`c-${i}`} fill={getSmashColor(e.SmashFactor)}/>))}</Scatter>{/* *** CHANGE: Target Zone for 9i *** */}<ReferenceArea x1={18} x2={26} y1={7500} y2={9500} stroke="#facc15" strokeOpacity={0.6} fill="#facc15" fillOpacity={0.05} label={{ value:'General 9i Zone', position:'insideTopLeft', fill:'#facc15', fontSize:10, dy:5, dx:5}}/><ReferenceLine x={stats.launchAngle.avg} stroke="#fb923c" strokeDasharray="2 2"/><ReferenceLine y={stats.spinRate.avg} stroke="#fb923c" strokeDasharray="2 2" label={{ value:`Avg (${stats.launchAngle.avg.toFixed(1)}Â°, ${(stats.spinRate.avg/1000).toFixed(1)}k)`, position:'insideBottomRight', fill:'#fb923c', fontSize:10}}/></ScatterChart></ResponsiveContainer><p className="text-xs text-center text-gray-400 mt-2 px-4">Size=Carry. Color=Smash. Box=Target.</p></div></ErrorBoundary>
                            <ErrorBoundary><div className="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700"><h3 className="text-xl font-semibold mb-4 text-center text-pink-300">Efficiency (Smash vs Speed) - 9i</h3><ResponsiveContainer width="100%" height={400}><ScatterChart margin={{ top: 20, right: 20, bottom: 40, left: 20 }}><CartesianGrid/><XAxis type="number" dataKey="x" name="Club Spd" unit=" mph" label={{ value:"Club Speed (mph)", position:'insideBottom', offset:-25, fill:'#9ca3af'}} stroke="#9ca3af" domain={['dataMin - 2', 'dataMax + 2']} tick={{ fill:'#d1d5db' }}/><YAxis type="number" dataKey="y" name="Smash" label={{ value:'Smash Factor', angle:-90, position:'insideLeft', offset:0, fill:'#9ca3af'}} stroke="#9ca3af" domain={[0.8, 1.40]} tickFormatter={(t)=>t.toFixed(2)} tick={{ fill:'#d1d5db' }}/><ZAxis type="number" dataKey="z" name="Carry" range={[30, 250]}/><Tooltip content={<CustomTooltip />}/><Scatter name="Efficiency" data={efficiencyData} shape="triangle">{efficiencyData.map((e, i)=>(<Cell key={`c-${i}`} fill={getSmashColor(e.y)}/>))}</Scatter>{/* *** CHANGE: Efficiency Zone for 9i *** */}<ReferenceLine y={1.25} stroke="#4ade80" strokeDasharray="3 3" label={{ value:'Efficient (1.25+)', position:'insideTopRight', fill:'#4ade80', fontSize:10}}/><ReferenceLine y={stats.smashFactor.avg} stroke="#f87171" strokeDasharray="4 1" label={{ value:`Avg (${stats.smashFactor.avg.toFixed(2)})`, position:'insideBottomRight', fill:'#f87171', fontSize:10, dy:10}}/></ScatterChart></ResponsiveContainer><p className="text-xs text-center text-gray-400 mt-2 px-4">Color=Smash. Size=Carry. Aim for 1.25+.</p></div></ErrorBoundary>
                            <ErrorBoundary><div className="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700 overflow-x-auto"><h3 className="text-xl font-semibold mb-4 text-center text-pink-300">9i Key Metrics Breakdown</h3><table className="w-full text-sm text-left text-gray-300 whitespace-nowrap"><thead className="text-xs text-gray-400 uppercase bg-gray-700"><tr><th>Metric</th><th className="text-right">Avg</th><th className="text-right">Med</th><th className="text-right">StdDev</th><th className="text-right">Min</th><th className="text-right">Max</th></tr></thead><tbody>{[ {k:'carryDistance',n:'Carry (yds)'},{k:'totalDistance',n:'Total (yds)'},{k:'sideCarry',n:'Side (yds)'},{k:'sideCarryAbs',n:'Avg Side Miss (yds)',ao:true},{k:'clubSpeed',n:'Club Spd (mph)'},{k:'ballSpeed',n:'Ball Spd (mph)'},{k:'smashFactor',n:'Smash Factor',f:true},{k:'launchAngle',n:'Launch (Â°)'},{k:'launchDirection',n:'Launch Dir (Â°)'},{k:'spinRate',n:'Spin (rpm)',r:true},{k:'spinAxis',n:'Spin Axis (Â°)'},{k:'apex',n:'Apex (ft)'},{k:'descentAngle',n:'Descent (Â°)'}].map(({k,n,f=false,ao=false,r=false})=>{const v=stats[k];if(!v||v.avg===undefined||isNaN(v.avg))return null;const d=f?2:(r?0:1);return(<tr key={k} className="bg-gray-800 border-b border-gray-700 hover:bg-gray-600"><td>{n}</td><td className="text-right">{v.avg.toFixed(d)}</td>{!ao&&<><td className="text-right">{v.median.toFixed(d)}</td><td className="text-right">{v.stdDev.toFixed(d)}</td><td className="text-right">{v.min.toFixed(d)}</td><td className="text-right">{v.max.toFixed(d)}</td></>}{ao&&<><td/><td/><td/><td/></>}</tr>);})}</tbody></table><p className="text-xs text-center text-gray-400 mt-2">Std Dev shows consistency (lower=better).</p></div></ErrorBoundary>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                            <ErrorBoundary><section className="bg-gray-800 p-6 rounded-xl shadow-2xl border border-gray-700 h-full"><h2 className="text-xl font-bold mb-4 text-yellow-400 border-b border-yellow-700 pb-2">Est. GIR Probability (9i)</h2><p className="text-sm text-gray-400 mb-4">Chance of hitting a 30x30 yd green.</p>{girProbabilities.length > 0 ? (<ul className="list-disc list-inside space-y-2 text-base text-gray-300">{girProbabilities.map(({ distance, probability }) => (<li key={distance}> From <strong className="text-white">{distance} yds</strong>: <span className={`ml-2 font-semibold ${getProbClass(probability)}`}>{probability.toFixed(1)}%</span></li>))}</ul>) : <p className="text-gray-500">Could not calculate.</p>}<p className="text-xs text-gray-500 mt-3">*Estimate.</p></section></ErrorBoundary>
                            <ErrorBoundary><section className="bg-gray-800 p-6 rounded-xl shadow-2xl border border-gray-700 h-full"><h2 className="text-xl font-bold mb-4 text-indigo-400 border-b border-indigo-700 pb-2">9i Shot Quality Probabilities</h2><p className="text-sm text-gray-400 mb-4">Likelihood of key consistency metrics.</p>{shotQualityProbs ? (<ul className="list-none space-y-3 text-base text-gray-300"><li className="flex justify-between items-center"><span>Dist. Control (Â±{shotQualityProbs.distanceWindow.toFixed(1)} yds):</span><span className={`font-semibold text-lg ${getProbClass(shotQualityProbs.distanceControlProb)}`}>{shotQualityProbs.distanceControlProb.toFixed(1)}%</span></li><li className="flex justify-between items-center"><span>Accuracy (Â±{shotQualityProbs.accuracyWindow.toFixed(1)} yds side):</span><span className={`font-semibold text-lg ${getProbClass(shotQualityProbs.accuracyProb)}`}>{shotQualityProbs.accuracyProb.toFixed(1)}%</span></li><li className="flex justify-between items-center"><span>Efficiency (Smash â¥ {shotQualityProbs.smashThreshold.toFixed(2)}):</span><span className={`font-semibold text-lg ${getProbClass(shotQualityProbs.highSmashProb)}`}>{shotQualityProbs.highSmashProb.toFixed(1)}%</span></li><li className="flex justify-between items-center border-t border-gray-700 pt-3 mt-2"><strong className="text-indigo-300">"Stock Shot" (Good Dist & Acc):</strong><span className={`font-semibold text-xl ${getProbClass(shotQualityProbs.stockShotProb)}`}>{shotQualityProbs.stockShotProb.toFixed(1)}%</span></li></ul>) : (<p className="text-gray-500">Could not calculate.</p>)}<p className="text-xs text-gray-500 mt-3">*Based on session & thresholds.</p></section></ErrorBoundary>
                        </div>

                        {/* *** CHANGE: Actionable Tips for 9-Iron *** */}
                        <ErrorBoundary><section className="mb-10 bg-gradient-to-br from-gray-800 to-gray-900 p-6 rounded-xl shadow-2xl border border-gray-700">{/* *** CHANGE: Update Title & Color *** */} <h2 className="text-2xl font-bold mb-4 text-purple-400 border-b border-purple-700 pb-2">The Precision Plan: 9-Iron Insights</h2><ul className="list-none space-y-4 text-base"><li className="flex items-start"><span className="text-yellow-400 text-xl mr-3 mt-1">ð¯</span><div><strong className="text-yellow-300">Dial in Distance Control:</strong> A Carry StdDev of <strong className="text-white">{stats.carryDistance.stdDev.toFixed(0)} yds</strong> is key for scoring. Aim for a tight window (see "Distance Control Prob." above). Poor Smash (Avg: {stats.smashFactor.avg.toFixed(2)}, StdDev: <strong className={stats.smashFactor.stdDev > 0.07 ? "text-red-400" : "text-yellow-400"}>{stats.smashFactor.stdDev.toFixed(2)}</strong>) hurts this.<br/><span className="text-gray-400 text-sm pl-4 block mt-1">â¡ï¸ Action: Focus on consistent strike (Smash > 1.25). Practice hitting to specific targets to feel distance differences.</span></div></li><li className="flex items-start"><span className="text-yellow-400 text-xl mr-3 mt-1">âï¸</span><div><strong className="text-yellow-300">Pinpoint Accuracy:</strong> An avg side miss of <strong className="text-white">{stats.sideCarryAbs.avg.toFixed(1)} yds</strong> needs tightening. Aim for the "Accuracy Prob." to be high. Launch Dir ({stats.launchDirection.avg.toFixed(1)}Â°) and Spin Axis ({stats.spinAxis.avg.toFixed(1)}Â°) show your tendencies.<br/><span className="text-gray-400 text-sm pl-4 block mt-1">â¡ï¸ Action: Alignment is critical. Work on clubface control. Is your common miss left or right? Address that first.</span></div></li><li className="flex items-start"><span className="text-yellow-400 text-xl mr-3 mt-1">ðªï¸</span><div><strong className="text-yellow-300">Master Spin & Trajectory:</strong> 9-irons are about stopping power. Avg Spin ({(stats.spinRate.avg/1000).toFixed(1)}k rpm) and Launch ({stats.launchAngle.avg.toFixed(1)}Â°) are key. Look for consistency in the Launch/Spin chart.<br/><span className="text-gray-400 text-sm pl-4 block mt-1">â¡ï¸ Action: Good strike = good spin. Aim for a launch window (e.g., 18-26Â°) & high spin (e.g., >7.5k rpm) for control.</span></div></li><li className="flex items-start"><span className="text-yellow-400 text-xl mr-3 mt-1">â¡</span><div><strong className="text-yellow-300">Efficient Strikes:</strong> Even with shorter clubs, good Smash Factor (Avg {stats.smashFactor.avg.toFixed(2)}) means you're not losing energy. Aim for the "High Efficiency Prob." to be high.<br/><span className="text-gray-400 text-sm pl-4 block mt-1">â¡ï¸ Action: Center contact. A solid strike feels effortless and maximizes spin and control for a 9-iron.</span></div></li></ul></section></ErrorBoundary>

                        {/* *** CHANGE: Conclusion for 9-Iron & Color *** */}
                        <ErrorBoundary><footer className="text-center pt-6 border-t border-gray-700"><h2 className="text-2xl font-bold mb-3 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">Final Verdict: 9-Iron</h2><p className="text-lg text-gray-300 mb-2">This club is about precision. Average carry: <strong className="text-white">{stats.carryDistance.avg.toFixed(0)} yds</strong>.</p><p className="text-lg text-gray-300 mb-2">Your Mission: <strong className="text-yellow-300 uppercase tracking-wider">Become a Target-Seeking Missile.</strong></p><p className="text-lg text-gray-400">Focus on <strong className="text-white">Consistent Strike (Smash > 1.25)</strong>, <strong className="text-white">Tight Dispersion</strong>, and <strong className="text-white">Optimal Spin</strong> to control the ball into greens.</p></footer></ErrorBoundary>
                    </div>
                );
            }

            console.log("Attempting to render React app..."); try { const c = document.getElementById('root'); if (!c) throw new Error("Root not found."); const rt = ReactDOM.createRoot(c); rt.render( <ErrorBoundary><App /></ErrorBoundary> ); console.log("Render initiated."); } catch (err) { console.error("React init failed:", err); const re = document.getElementById('root'); if (re) re.innerHTML = `<div class="error-message"><h1>Fatal React Error</h1><p>Init failed.</p><p>Error: <code>${err.message}</code></p><p>Check console (F12).</p></div>`; else document.body.innerHTML = `<div class="error-message"><h1>Fatal Error</h1><p>Root missing & React failed.</p><p>Error: <code>${err.message}</code></p></div>`; }
        }
        if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', runApplication); } else { runApplication(); }
    </script>
</body>
</html>